<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebBash Repository File Browser (RAWè¡¨ç¤º)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Tailwind CSSã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¾®èª¿æ•´ */
        .container {
            max-width: 900px;
        }
        .item {
            cursor: pointer;
            transition: all 0.1s ease-in-out;
            display: flex;
            align-items: center;
        }
        .item:hover {
            transform: translateX(3px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .dir {
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8 font-sans">

<div class="container mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-2xl">
    <h1 class="text-3xl font-extrabold text-blue-800 border-b-4 border-blue-400 pb-3 mb-6">
        WebBash ãƒªãƒã‚¸ãƒˆãƒª ãƒ•ã‚¡ã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶
    </h1>

    <div id="path" class="text-lg font-mono text-gray-700 bg-blue-50 p-3 rounded-lg mb-6 shadow-inner">
        Loading...
    </div>

    <h2 class="text-2xl font-semibold text-gray-700 mb-4">ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§</h2>
    
    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="file-list" class="space-y-2">
        <p class="text-gray-500">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ­ãƒ¼ãƒ‰ä¸­...</p>
    </div>
    
    <div class="mt-8 pt-4 border-t border-gray-200 text-sm text-gray-500">
        â€» **HTMLãƒ•ã‚¡ã‚¤ãƒ«**ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€**ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã¨ã—ã¦**é–‹ãã¾ã™ã€‚ãã®ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯RAWã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã—ã¦é–‹ãã¾ã™ã€‚ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãã®éšå±¤ã¸ç§»å‹•ã—ã¾ã™ã€‚
    </div>
</div>

<script>
    const REPO_OWNER = 'pipocorp-japan';
    const REPO_NAME = 'WebBash';
    // GitHub Contents APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    const API_URL = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/`;

    const fileListElement = document.getElementById('file-list');
    const pathElement = document.getElementById('path');
    let currentPath = '';
    
    /**
     * GitHub APIã‹ã‚‰æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ•ã‚§ãƒƒãƒã—ã€è¡¨ç¤ºã‚’æ›´æ–°ã—ã¾ã™ã€‚
     * @param {string} path - ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ‘ã‚¹
     */
    async function fetchContents(path) {
        currentPath = path;
        pathElement.textContent = `ç¾åœ¨ã®ãƒ‘ã‚¹: /${currentPath}`;
        fileListElement.innerHTML = '<div class="flex items-center space-x-2 text-blue-600"><svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ­ãƒ¼ãƒ‰ä¸­...</span></div>';

        const url = API_URL + path;

        try {
            const response = await fetch(url);
            if (!response.ok) {
                // APIãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆãªã©ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
                throw new Error(`HTTPã‚¨ãƒ©ãƒ¼! ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}ã€‚GitHub APIã®ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã«é”ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`);
            }
            const data = await response.json();
            // é…åˆ—ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
            if (Array.isArray(data)) {
                 renderList(data, path);
            } else {
                 throw new Error("APIã‹ã‚‰äºˆæœŸã—ãªã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒè¿”ã•ã‚Œã¾ã—ãŸã€‚");
            }
           
        } catch (error) {
            fileListElement.innerHTML = `<p class="text-red-500 p-3 bg-red-100 rounded-lg">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</p>`;
            console.error(error);
        }
    }

    /**
     * å–å¾—ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
     * @param {Array<Object>} data - GitHub APIã‹ã‚‰å–å¾—ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã®é…åˆ—
     * @param {string} path - ç¾åœ¨ã®ãƒ‘ã‚¹
     */
    function renderList(data, path) {
        fileListElement.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢

        // 1. éšå±¤ã‚’ä¸ŠãŒã‚‹ãŸã‚ã®ãƒªãƒ³ã‚¯ (ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãƒ«ãƒ¼ãƒˆã§ãªã„å ´åˆ)
        if (path) {
            const upPath = path.includes('/') ? path.substring(0, path.lastIndexOf('/')) : '';
            const upLink = createListItem('.. (è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)', 'dir', upPath);
            fileListElement.appendChild(upLink);
        }

        // 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚½ãƒ¼ãƒˆ (ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå„ªå…ˆã€ãã®å¾Œã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †)
        data.sort((a, b) => {
            if (a.type === 'dir' && b.type !== 'dir') return -1;
            if (a.type !== 'dir' && b.type === 'dir') return 1;
            return a.name.localeCompare(b.name);
        });

        // 3. ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒªã‚¹ãƒˆè¡¨ç¤º
        data.forEach(item => {
            const itemPath = path ? `${path}/${item.name}` : item.name;
            const listItem = createListItem(item.name, item.type, itemPath, item.download_url);
            fileListElement.appendChild(listItem);
        });
    }

    /**
     * ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ  (ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ•ã‚©ãƒ«ãƒ€) ã®DOMè¦ç´ ã‚’ä½œæˆã—ã¾ã™ã€‚
     * @param {string} name - ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€å
     * @param {string} type - 'file' ã¾ãŸã¯ 'dir'
     * @param {string} path - ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ (ä¾‹: 'src/main.js')
     * @param {string} downloadUrl - RAWãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ç›´æ¥ãƒªãƒ³ã‚¯
     */
    function createListItem(name, type, path, downloadUrl = null) {
        const div = document.createElement('div');
        
        // Tailwindã‚¯ãƒ©ã‚¹ã§ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
        div.classList.add('item', type, 'p-3', 'rounded-lg', 'border', 'border-gray-200');

        let icon = '';
        let textColor = 'text-gray-800';

        if (type === 'dir') {
            icon = 'ğŸ“';
            textColor = 'text-green-700';
            div.classList.add('bg-green-50', 'hover:bg-green-100');
        } else if (name === '.. (è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)') {
            icon = 'â¤´ï¸';
            textColor = 'text-blue-700';
            div.classList.add('bg-blue-50', 'hover:bg-blue-100');
        } else {
            icon = 'ğŸ“„';
            textColor = 'text-gray-800';
            div.classList.add('bg-white', 'hover:bg-gray-50');
        }

        div.innerHTML = `<span class="text-xl mr-3">${icon}</span> <span class="${textColor} text-base">${name}</span>`;

        div.onclick = (e) => {
            e.preventDefault();
            if (type === 'dir' || name === '.. (è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)') {
                // ãƒ•ã‚©ãƒ«ãƒ€ã®å ´åˆ: æ–°ã—ã„éšå±¤ã‚’ãƒ•ã‚§ãƒƒãƒ
                fetchContents(path);
            } else if (type === 'file') {
                // ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ: å‡¦ç†ã‚’åˆ†å²
                const isHtml = name.toLowerCase().endsWith('.html') || name.toLowerCase().endsWith('.htm');
                
                if (isHtml) {
                    // HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ: GitHub Pages URLã‚’æ§‹ç¯‰ã—ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦é–‹ã
                    // pathã¯ "dir/filename.html" ã®å½¢å¼ã«ãªã£ã¦ã„ã‚‹
                    const REPO_HOST_URL = `https://${REPO_OWNER}.github.io/${REPO_NAME}/`;
                    const renderUrl = REPO_HOST_URL + path;
                    window.open(renderUrl, '_blank');
                } else if (downloadUrl) {
                    // ãã®ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ: RAWã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
                    window.open(downloadUrl, '_blank');
                }
            }
        };
        return div;
    }

    // åˆæœŸåŒ–: ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒ­ãƒ¼ãƒ‰
    window.onload = function() {
        fetchContents('');
    };
</script>

</body>
</html>
